<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>メニュー選択 - ウェブ予約</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.20/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-base-200 flex items-center justify-center p-4">
    <div class="card w-full max-w-md bg-base-100 shadow-xl">
        <div class="card-body">
            <h1 class="card-title text-xl font-bold text-center mb-6">メニュー選択</h1>
            <p class="text-center mb-8 text-base-content/70">ご希望の操作を選択してください。</p>
            
            <div class="space-y-4">
                <a href="03_course_selection.html" class="btn btn-primary btn-lg w-full">
                    予約に進む
                </a>
                <a href="09_reservation_management.html" class="btn btn-secondary btn-lg w-full">
                    予約確認・変更・キャンセル
                </a>
            </div>
            
            <div class="mt-8 border-t pt-4">
                <h2 class="font-semibold mb-2">前倒し依頼</h2>
                <div id="earlyRequests" class="space-y-2 text-sm"></div>
            </div>
            <div class="text-center mt-6">
                <a href="01_index.html" class="btn btn-ghost btn-sm">ログアウト</a>
            </div>
        </div>
    </div>
<script>
document.addEventListener('DOMContentLoaded', function(){ renderEarlyRequests(); });
function renderEarlyRequests(){ const wrap=document.getElementById('earlyRequests'); if(!wrap) return; wrap.innerHTML=''; const keys=Object.keys(localStorage).filter(k=>k.startsWith('early_')); if(keys.length===0){ wrap.innerHTML='<div class="opacity-70">現在、前倒し依頼はありません。</div>'; return; } keys.forEach(k=>{ try{ const req=JSON.parse(localStorage.getItem(k)); if(!req||req.status!=='pending') return; const div=document.createElement('div'); div.className='p-3 rounded bg-base-200 flex items-center justify-between'; const left=document.createElement('div'); left.innerHTML=`<div class="font-semibold">${req.date} ${req.time}</div><div class="opacity-70">${req.candidate} へ前倒し提案</div>`; const right=document.createElement('div'); right.className='flex gap-2'; const ok=document.createElement('button'); ok.className='btn btn-success btn-xs'; ok.innerHTML='<i class="fas fa-check mr-1"></i>承認'; ok.onclick=()=>approveEarly(req); const ng=document.createElement('button'); ng.className='btn btn-error btn-xs'; ng.innerHTML='<i class="fas fa-times mr-1"></i>却下'; ng.onclick=()=>rejectEarly(req); right.appendChild(ok); right.appendChild(ng); div.appendChild(left); div.appendChild(right); wrap.appendChild(div); }catch{} }); }
function approveEarly(req){ try{ req.status='approved'; localStorage.setItem(req.id, JSON.stringify(req)); // 既存予約キーを移動
  const oldKey=`schedule_${req.date}_${req.time}`; const data=JSON.parse(localStorage.getItem(oldKey)||'null'); if(data){ localStorage.removeItem(oldKey); const newKey=`schedule_${req.date}_${req.candidate}`; data.time=req.candidate; localStorage.setItem(newKey, JSON.stringify(data)); }
  alert('前倒しを承認しました。'); }catch{} renderEarlyRequests(); }
function rejectEarly(req){ try{ req.status='rejected'; localStorage.setItem(req.id, JSON.stringify(req)); alert('前倒しを却下しました。'); }catch{} renderEarlyRequests(); }
</script>
</body>
</html>
