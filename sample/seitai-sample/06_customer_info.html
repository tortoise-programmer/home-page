<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>予約者情報入力 - ウェブ予約</title>
    <link href="https://cdn.jsdelivr.net/npm/daisyui@4.4.20/dist/full.min.css" rel="stylesheet" type="text/css" />
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="min-h-screen bg-base-200 p-4">
    <div class="container mx-auto max-w-md">
        <div class="card bg-base-100 shadow-xl">
            <div class="card-body">
                <h1 id="page-title" class="card-title text-xl font-bold text-center justify-center mb-6">予約者情報入力</h1>

                <!-- ステップフロー -->
                <div id="steps" class="steps steps-horizontal w-full mb-8">
                    <div class="step step-primary">予約内容</div>
                    <div class="step step-primary">予約日時</div>
                    <div class="step step-primary">予約者情報</div>
                    <div class="step">内容確認</div>
                </div>
                
                <!-- 戻るボタン -->
                <div class="flex justify-start mb-4">
                    <a id="back-link" href="05_date_selection.html" class="btn btn-ghost btn-sm">
                        ← 戻る
                    </a>
                </div>
                
                
                <form action="07_confirmation.html" method="post" class="space-y-4">

                    <div class="form-control">
                        <button 
                            type="button"
                            class="btn btn-line w-full mb-2 transition-shadow duration-150 shadow-lg hover:shadow-xl hover:-translate-y-1"
                            style="box-shadow: 0 4px 24px rgba(6,199,85,0.15);"
                            onclick="alert('LINE連携機能は現在準備中です')"
                        >
                            <i class="fab fa-line mr-2"></i>LINEで登録する
                        </button>
                    </div>
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">氏名 <span class="text-error">*</span></span>
                        </label>
                        <input type="text" name="name" class="input input-bordered" placeholder="例: 山田太郎" required>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">ふりがな <span class="text-error">*</span></span>
                        </label>
                        <input type="text" name="kana" class="input input-bordered" placeholder="例: やまだたろう" required>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">メールアドレス <span class="text-error">*</span></span>
                        </label>
                        <input type="email" name="email" class="input input-bordered" placeholder="例: yamada@example.com" required>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">生年月日 <span class="text-error">*</span></span>
                        </label>
                        <input type="date" name="birthday" class="input input-bordered" required>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">性別 <span class="text-error">*</span></span>
                        </label>
                        <select name="gender" class="select select-bordered" required>
                            <option value="">選択してください</option>
                            <option value="male">男性</option>
                            <option value="female">女性</option>
                            <option value="other">その他</option>
                        </select>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">携帯電話 <span class="text-error">*</span></span>
                        </label>
                        <input type="tel" name="phone" id="phone-input" class="input input-bordered" placeholder="例: 090-1234-5678" required>
                        <div id="phone-error" class="label-text-alt text-error hidden">この電話番号は既に登録されています</div>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">パスワード <span class="text-error">*</span></span>
                        </label>
                        <input type="password" name="password" class="input input-bordered" placeholder="8文字以上" required minlength="8">
                        <label class="label">
                            <span class="label-text-alt text-xs">※次回予約時に使用します</span>
                        </label>
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">パスワード（確認） <span class="text-error">*</span></span>
                        </label>
                        <input type="password" name="password_confirm" class="input input-bordered" placeholder="再度入力してください" required minlength="8">
                    </div>
                    
                    <div class="form-control">
                        <label class="label">
                            <span class="label-text">備考・相談事項</span>
                        </label>
                        <textarea name="notes" class="textarea textarea-bordered h-20" placeholder="気になる症状や相談したいことがあればご記入ください（任意）"></textarea>
                    </div>
                    
                    <div class="form-control">
                        <label class="cursor-pointer label">
                            <input type="checkbox" name="agreement" class="checkbox checkbox-primary" required />
                            <span class="label-text ml-2">
                                <a href="#" class="link link-primary">利用規約</a>と
                                <a href="#" class="link link-primary">プライバシーポリシー</a>に同意します <span class="text-error">*</span>
                            </span>
                        </label>
                    </div>
                    
                    <div class="form-control mt-6">
                        <button type="submit" class="btn btn-primary btn-lg">次へ</button>
                    </div>
                </form>
                
                <div class="text-center mt-4">
                    <a id="back-link-bottom" href="05_date_selection.html" class="btn btn-ghost btn-sm">戻る</a>
                </div>
            </div>
        </div>
    </div>
    <script>
        (function(){
            try{
                var params = new URLSearchParams(location.search);
                var isSignup = params.get('mode') === 'signup';
                if(!isSignup) return;

                var titleEl = document.getElementById('page-title');
                if(titleEl){ titleEl.textContent = '新規会員登録'; }

                var stepsEl = document.getElementById('steps');
                if(stepsEl){
                    stepsEl.innerHTML = ''+
                        '<div class="step step-primary">会員登録</div>'+
                        '<div class="step">内容確認</div>';
                }

                try{ sessionStorage.setItem('visitType', 'first'); }catch(_e){}

                var formEl = document.querySelector('form[action]');
                if(formEl){
                    formEl.setAttribute('action', '03_course_selection.html?type=first');
                    formEl.setAttribute('method', 'get');
                }

                // 電話番号重複チェック
                var phoneInput = document.getElementById('phone-input');
                var phoneError = document.getElementById('phone-error');
                if(phoneInput && phoneError){
                    phoneInput.addEventListener('blur', function(){
                        var phone = this.value.replace(/[-\s]/g, '');
                        if(phone.length >= 10){
                            // モックデータで重複チェック（実際はAPI呼び出し）
                            var existingPhones = ['09012345678', '08012345678', '07012345678'];
                            if(existingPhones.includes(phone)){
                                phoneError.classList.remove('hidden');
                                phoneInput.classList.add('input-error');
                            } else {
                                phoneError.classList.add('hidden');
                                phoneInput.classList.remove('input-error');
                            }
                        }
                    });
                }

                var backEls = [
                  document.getElementById('back-link'),
                  document.getElementById('back-link-bottom')
                ].filter(Boolean);
                backEls.forEach(function(el){ el.setAttribute('href', '01_index.html'); });
            }catch(e){ console.error(e); }
        })();
    </script>
</body>
</html>
